**consul** 



Consul 能干嘛，用它做过什么

做服务发现的注册中心， 服务可以通过 http 与 consul 交互，并且可以进行多数据中心之间的调用 （例如：ali 的集群请求 tecent 的集群，都可以实现）



//consul 注册中心原理

https://blog.csdn.net/weixin_42073629/article/details/106991532





1.我们先实现一个简易的注册中心，实现两个功能 1. 服务注册与获取2.服务健康检查

我们用一个 带有 kv 功能的单进程（这就可以保证强一致）实现服务注册与发现。 服务间调用可以直接先请求 注册中心，然后找一台机器请求。 健康检查可以让每个注册服务定时发送心跳，超过多少没心跳就delete节点



2.以上实现有两个问题 1.注册中心单点故障 2.健康检查对 注册中心来说 压力很大



如何解决？

问题1 ：我们通过增加多台机器实现高可用，提供一个选举机制，leader 来做响应，并且把信息同步给大多数 follower 后才真正响应成功，这样保证切换leader 后 新的leader 也有上下文， 如何实现？用raft 协议，可以实现共识选举，并且可以实现强一直

问题2：我们需要减轻注册中心健康检查的压力，可以选择给他一个代理，让代理做主要的健康检查功能，当确定服务进程挂了后再同步 注册中心即可。



以上就实现了一个简易的注册中心，对应到 consul 上 server 做注册中心，agent 作为代理实现健康检查